<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campanhas - RifaApp</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Estilos espec√≠ficos para campanhas */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: white;
            transform: scale(1.1);
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 20px 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .campaigns-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px 100px;
        }

        .campaign-filters {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .filter-input {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .campaigns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .campaign-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .campaign-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .campaign-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: relative;
        }

        .campaign-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status-completed {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
            border: 1px solid rgba(108, 117, 125, 0.3);
        }

        .status-paused {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .campaign-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            margin-right: 80px;
        }

        .campaign-subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .campaign-body {
            padding: 25px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
        }

        .progress-section {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .campaign-actions {
            display: flex;
            gap: 10px;
        }

        .btn-view {
            flex: 1;
            padding: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-edit {
            padding: 10px 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-edit:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Modal de detalhes */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 95%;
            max-width: 1000px;
            max-height: 95vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 30px;
        }

        .detail-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .detail-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .detail-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .detail-content {
            display: none;
        }

        .detail-content.active {
            display: block;
        }

        .detail-section {
            margin-bottom: 30px;
        }

        .detail-section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .buyers-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .buyer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .buyer-info {
            flex: 1;
        }

        .buyer-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .buyer-details {
            font-size: 0.9rem;
            color: #666;
        }

        .buyer-amount {
            text-align: right;
        }

        .buyer-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }

        .buyer-tickets {
            font-size: 0.8rem;
            color: #666;
        }

        .affiliates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .affiliate-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .affiliate-name {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .affiliate-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 0.9rem;
        }

        .affiliate-stat {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .winning-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .winning-number {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .campaigns-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .detail-tabs {
                flex-direction: column;
            }

            .modal-content {
                width: 98%;
                margin: 1% auto;
            }
        }

        /* Estilos para o bot√£o de suporte */
        .support-button {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .support-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Estilos para as op√ß√µes de suporte */
        .support-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 10px;
        }

        .support-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.5s ease;
            width: 100%;
            text-align: right;
        }

        .support-option:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .support-icon {
            font-size: 1.5rem;
        }

        .support-text {
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="window.location.href='home.html'">
        ‚Üê
    </button>

    <div class="page-header">
        <h1 class="page-title">üìä An√°lise de Campanhas</h1>
        <p class="page-subtitle">Monitore o desempenho detalhado de suas rifas</p>
    </div>

    <div class="campaigns-container">
        <!-- Filtros -->
        <div class="campaign-filters">
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">Status da Campanha</label>
                    <select class="filter-input" id="statusFilter">
                        <option value="">Todos os status</option>
                        <option value="active">Ativas</option>
                        <option value="completed">Finalizadas</option>
                        <option value="paused">Pausadas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Per√≠odo</label>
                    <select class="filter-input" id="periodFilter">
                        <option value="">Todos os per√≠odos</option>
                        <option value="today">Hoje</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este m√™s</option>
                        <option value="quarter">√öltimos 3 meses</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Ordenar por</label>
                    <select class="filter-input" id="sortFilter">
                        <option value="recent">Mais recentes</option>
                        <option value="revenue">Maior receita</option>
                        <option value="tickets">Mais bilhetes vendidos</option>
                        <option value="conversion">Maior convers√£o</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Buscar campanha</label>
                    <input type="text" class="filter-input" id="searchFilter" placeholder="Nome da rifa...">
                </div>
            </div>
        </div>

        <!-- Grid de Campanhas -->
        <div class="campaigns-grid" id="campaignsGrid">
            <!-- Campanhas ser√£o carregadas aqui -->
        </div>
    </div>

    <!-- Modal de detalhes da campanha -->
    <div id="campaignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Detalhes da Campanha</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="detail-tabs">
                    <button class="detail-tab active" onclick="switchDetailTab('overview')">üìä Vis√£o Geral</button>
                    <button class="detail-tab" onclick="switchDetailTab('buyers')">üë• Compradores</button>
                    <button class="detail-tab" onclick="switchDetailTab('affiliates')">ü§ù Afiliados</button>
                    <button class="detail-tab" onclick="switchDetailTab('winners')">üèÜ Ganhadores</button>
                </div>

                <!-- Aba: Vis√£o Geral -->
                <div id="overview" class="detail-content active">
                    <div class="stats-grid" id="overviewStats">
                        <!-- Stats ser√£o carregados aqui -->
                    </div>
                    
                    <div class="detail-section">
                        <div class="detail-section-title">üìà Performance da Campanha</div>
                        <div id="performanceChart">
                            <!-- Gr√°fico seria implementado aqui -->
                            <div style="background: #f8f9fa; padding: 40px; text-align: center; border-radius: 10px; color: #666;">
                                üìä Gr√°fico de Performance<br>
                                <small>Vendas ao longo do tempo</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba: Compradores -->
                <div id="buyers" class="detail-content">
                    <div class="detail-section">
                        <div class="detail-section-title">üèÜ Maiores Compradores</div>
                        <div class="buyers-list" id="buyersList">
                            <!-- Lista de compradores ser√° carregada aqui -->
                        </div>
                    </div>
                </div>

                <!-- Aba: Afiliados -->
                <div id="affiliates" class="detail-content">
                    <div class="detail-section">
                        <div class="detail-section-title">ü§ù Vendas por Afiliado</div>
                        <div class="affiliates-grid" id="affiliatesList">
                            <!-- Lista de afiliados ser√° carregada aqui -->
                        </div>
                    </div>
                </div>

                <!-- Aba: Ganhadores -->
                <div id="winners" class="detail-content">
                    <div class="detail-section">
                        <div class="detail-section-title">üéØ Bilhetes Premiados</div>
                        <div class="winning-numbers" id="winningNumbers">
                            <!-- N√∫meros ganhadores ser√£o carregados aqui -->
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <div class="detail-section-title">üèÜ Ganhadores</div>
                        <div id="winnersList">
                            <!-- Lista de ganhadores ser√° carregada aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√£o flutuante de suporte -->
    <button class="support-button" onclick="openSupportModal()" title="Suporte">
        üí¨
    </button>

    <!-- Modal de suporte -->
    <div id="support-modal" class="modal">
        <div class="modal-content" style="max-width: 300px;">
            <div class="modal-header">
                <h3>üìû Suporte</h3>
                <button class="close-btn" onclick="closeSupportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="support-options">
                    <button class="support-option" onclick="openWhatsAppSupport()">
                        <span class="support-icon">üí¨</span>
                        <span class="support-text">Suporte por WhatsApp</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o Inferior -->
    <nav class="bottom-nav">
        <button class="nav-btn" onclick="window.location.href='home.html'">
            <span class="nav-icon">üè†</span>
            <span class="nav-text">In√≠cio</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='criar.html'">
            <span class="nav-icon">‚ûï</span>
            <span class="nav-text">Criar</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='rifas.html'">
            <span class="nav-icon">üìã</span>
            <span class="nav-text">Minhas</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='dashboard.html'">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">Dashboard</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='carteira.html'">
            <span class="nav-icon">üí∞</span>
            <span class="nav-text">Carteira</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='afiliados.html'">
            <span class="nav-icon">ü§ù</span>
            <span class="nav-text">Afiliados</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='pedidos.html'">
            <span class="nav-icon">üìã</span>
            <span class="nav-text">Pedidos</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='integracoes.html'">
            <span class="nav-icon">üîó</span>
            <span class="nav-text">Integra√ß√µes</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='configuracoes.html'">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-text">Configura√ß√µes</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='campanhas.html'">
            <span class="nav-icon">üìä</span>
            <span class="nav-text">Campanhas</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='tutoriais.html'">
            <span class="nav-icon">üìö</span>
            <span class="nav-text">Tutoriais</span>
        </button>
        <button class="nav-btn" onclick="window.location.href='perfil.html'">
            <span class="nav-icon">üë§</span>
            <span class="nav-text">Perfil</span>
        </button>
    </nav>

    <script src="js/data.js"></script>
    <script>
        class CampanhasPage {
            constructor() {
                this.campaigns = [];
                this.filteredCampaigns = [];
                this.currentCampaign = null;
                this.init();
            }

            init() {
                this.loadCampaigns();
                this.bindEvents();
                this.renderCampaigns();
            }

            loadCampaigns() {
                const rifas = dataManager.getRifas();
                const participations = dataManager.getParticipations();
                const users = dataManager.getUsers();

                this.campaigns = rifas.map(rifa => {
                    const rifaParticipations = participations.filter(p => p.rifaId === rifa.id);
                    const uniqueUsers = new Set(rifaParticipations.map(p => p.userId)).size;
                    const totalTickets = rifaParticipations.reduce((sum, p) => sum + p.ticketCount, 0);
                    const totalRevenue = rifaParticipations.reduce((sum, p) => sum + p.totalPaid, 0);
                    const avgTicket = totalRevenue / (rifaParticipations.length || 1);
                    const conversionRate = (totalTickets / rifa.totalTickets) * 100;

                    // Simula dados de afiliados
                    const affiliateData = this.generateAffiliateData(rifaParticipations);
                    
                    // Simula descontos aplicados
                    const discountsApplied = Math.floor(Math.random() * 15) + 5;

                    return {
                        ...rifa,
                        uniqueUsers,
                        totalTickets: totalTickets,
                        soldTickets: totalTickets,
                        totalRevenue,
                        avgTicket,
                        conversionRate,
                        participations: rifaParticipations,
                        affiliates: affiliateData,
                        discountsApplied,
                        status: this.getCampaignStatus(rifa),
                        winningNumbers: this.generateWinningNumbers(rifa),
                        winners: this.generateWinners(rifa, rifaParticipations, users)
                    };
                });

                this.filteredCampaigns = [...this.campaigns];
            }

            generateAffiliateData(participations) {
                const affiliates = [
                    { name: 'Jo√£o Afiliado', email: 'joao@afiliado.com' },
                    { name: 'Maria Vendedora', email: 'maria@vendedora.com' },
                    { name: 'Pedro Promotor', email: 'pedro@promotor.com' }
                ];

                return affiliates.map(affiliate => {
                    const sales = Math.floor(Math.random() * participations.length * 0.3);
                    const revenue = sales * (Math.random() * 50 + 10);
                    const commission = revenue * 0.1;

                    return {
                        ...affiliate,
                        sales,
                        revenue,
                        commission,
                        conversionRate: Math.random() * 15 + 5
                    };
                });
            }

            generateWinningNumbers(rifa) {
                if (rifa.status === 'completed') {
                    const count = Math.floor(Math.random() * 3) + 1;
                    const numbers = [];
                    for (let i = 0; i < count; i++) {
                        numbers.push(Math.floor(Math.random() * rifa.totalTickets) + 1);
                    }
                    return numbers;
                }
                return [];
            }

            generateWinners(rifa, participations, users) {
                if (rifa.status === 'completed' && participations.length > 0) {
                    const winnerCount = Math.min(3, participations.length);
                    const winners = [];
                    
                    for (let i = 0; i < winnerCount; i++) {
                        const participation = participations[Math.floor(Math.random() * participations.length)];
                        const user = users.find(u => u.id === participation.userId);
                        
                        if (user && !winners.find(w => w.userId === user.id)) {
                            winners.push({
                                userId: user.id,
                                name: this.generateFullName(),
                                email: user.email,
                                prize: i === 0 ? '1¬∫ Lugar' : i === 1 ? '2¬∫ Lugar' : '3¬∫ Lugar',
                                ticketNumber: Math.floor(Math.random() * rifa.totalTickets) + 1
                            });
                        }
                    }
                    return winners;
                }
                return [];
            }

            generateFullName() {
                const names = [
                    'Jo√£o Silva Santos', 'Maria Oliveira Costa', 'Pedro Lima Ferreira',
                    'Ana Carolina Souza', 'Carlos Mendes Alves', 'Fernanda Rodrigues Lima'
                ];
                return names[Math.floor(Math.random() * names.length)];
            }

            getCampaignStatus(rifa) {
                const now = new Date();
                const endDate = new Date(rifa.drawDate);
                
                if (rifa.status === 'completed') return 'completed';
                if (endDate < now) return 'completed';
                if (rifa.status === 'paused') return 'paused';
                return 'active';
            }

            bindEvents() {
                // Filtros
                document.getElementById('statusFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('periodFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('sortFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('searchFilter').addEventListener('input', () => this.applyFilters());
            }

            applyFilters() {
                const statusFilter = document.getElementById('statusFilter').value;
                const periodFilter = document.getElementById('periodFilter').value;
                const sortFilter = document.getElementById('sortFilter').value;
                const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

                this.filteredCampaigns = this.campaigns.filter(campaign => {
                    // Filtro por status
                    if (statusFilter && campaign.status !== statusFilter) return false;
                    
                    // Filtro por busca
                    if (searchFilter && !campaign.title.toLowerCase().includes(searchFilter)) return false;
                    
                    // Filtro por per√≠odo seria implementado aqui
                    
                    return true;
                });

                // Ordena√ß√£o
                this.filteredCampaigns.sort((a, b) => {
                    switch (sortFilter) {
                        case 'revenue':
                            return b.totalRevenue - a.totalRevenue;
                        case 'tickets':
                            return b.soldTickets - a.soldTickets;
                        case 'conversion':
                            return b.conversionRate - a.conversionRate;
                        default:
                            return new Date(b.createdAt) - new Date(a.createdAt);
                    }
                });

                this.renderCampaigns();
            }

            renderCampaigns() {
                const container = document.getElementById('campaignsGrid');
                
                if (this.filteredCampaigns.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #666;">
                            <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;">üìä</div>
                            <div style="font-size: 1.2rem; margin-bottom: 10px;">Nenhuma campanha encontrada</div>
                            <div style="opacity: 0.7;">Tente ajustar os filtros ou criar uma nova rifa</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.filteredCampaigns.map(campaign => `
                    <div class="campaign-card" onclick="showCampaignDetails(${campaign.id})">
                        <div class="campaign-header">
                            <div class="campaign-status status-${campaign.status}">
                                ${campaign.status === 'active' ? 'Ativa' : 
                                  campaign.status === 'completed' ? 'Finalizada' : 'Pausada'}
                            </div>
                            <div class="campaign-title">${campaign.title}</div>
                            <div class="campaign-subtitle">
                                Criada em ${this.formatDate(campaign.createdAt)}
                            </div>
                        </div>
                        <div class="campaign-body">
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <div class="metric-value">${campaign.uniqueUsers}</div>
                                    <div class="metric-label">Usu√°rios √önicos</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${dataManager.formatCurrency(campaign.avgTicket)}</div>
                                    <div class="metric-label">Ticket M√©dio</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${campaign.soldTickets}</div>
                                    <div class="metric-label">Bilhetes Vendidos</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${campaign.conversionRate.toFixed(1)}%</div>
                                    <div class="metric-label">Taxa Convers√£o</div>
                                </div>
                            </div>
                            
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>Progresso</span>
                                    <span>${campaign.soldTickets}/${campaign.totalTickets}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${(campaign.soldTickets / campaign.totalTickets) * 100}%"></div>
                                </div>
                            </div>
                            
                            <div class="campaign-actions">
                                <button class="btn-view">üìä Ver Detalhes</button>
                                <button class="btn-edit" onclick="event.stopPropagation(); editCampaign(${campaign.id})">‚úèÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('pt-BR');
            }
        }

        // Fun√ß√µes globais
        function showCampaignDetails(campaignId) {
            const campaign = window.campanhasPage.campaigns.find(c => c.id === campaignId);
            if (!campaign) return;

            window.campanhasPage.currentCampaign = campaign;
            
            document.getElementById('modalTitle').textContent = campaign.title;
            loadOverviewTab(campaign);
            
            document.getElementById('campaignModal').style.display = 'block';
        }

        function loadOverviewTab(campaign) {
            const statsContainer = document.getElementById('overviewStats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-value">${campaign.uniqueUsers}</div>
                    <div class="stat-label">Usu√°rios √önicos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value">${dataManager.formatCurrency(campaign.avgTicket)}</div>
                    <div class="stat-label">Ticket M√©dio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üé´</div>
                    <div class="stat-value">${campaign.totalTickets}</div>
                    <div class="stat-label">Total de Bilhetes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value">${campaign.conversionRate.toFixed(1)}%</div>
                    <div class="stat-label">Taxa de Convers√£o</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∏</div>
                    <div class="stat-value">${dataManager.formatCurrency(campaign.totalRevenue)}</div>
                    <div class="stat-label">Receita Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üè∑Ô∏è</div>
                    <div class="stat-value">${campaign.discountsApplied}</div>
                    <div class="stat-label">Descontos Aplicados</div>
                </div>
            `;
        }

        function switchDetailTab(tabName) {
            // Remove active de todas as abas
            document.querySelectorAll('.detail-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.detail-content').forEach(content => content.classList.remove('active'));

            // Ativa a aba selecionada
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            const campaign = window.campanhasPage.currentCampaign;
            if (!campaign) return;

            // Carrega conte√∫do espec√≠fico da aba
            switch (tabName) {
                case 'buyers':
                    loadBuyersTab(campaign);
                    break;
                case 'affiliates':
                    loadAffiliatesTab(campaign);
                    break;
                case 'winners':
                    loadWinnersTab(campaign);
                    break;
            }
        }

        function loadBuyersTab(campaign) {
            const container = document.getElementById('buyersList');
            const users = dataManager.getUsers();
            
            // Agrupa participa√ß√µes por usu√°rio
            const buyerStats = {};
            campaign.participations.forEach(participation => {
                const user = users.find(u => u.id === participation.userId);
                if (user) {
                    if (!buyerStats[user.id]) {
                        buyerStats[user.id] = {
                            user: user,
                            totalTickets: 0,
                            totalPaid: 0,
                            purchases: 0
                        };
                    }
                    buyerStats[user.id].totalTickets += participation.ticketCount;
                    buyerStats[user.id].totalPaid += participation.totalPaid;
                    buyerStats[user.id].purchases++;
                }
            });

            const sortedBuyers = Object.values(buyerStats)
                .sort((a, b) => b.totalPaid - a.totalPaid);

            container.innerHTML = sortedBuyers.map((buyer, index) => `
                <div class="buyer-item">
                    <div class="buyer-info">
                        <div class="buyer-name">#${index + 1} ${window.campanhasPage.generateFullName()}</div>
                        <div class="buyer-details">${buyer.user.email} ‚Ä¢ ${buyer.purchases} compra${buyer.purchases > 1 ? 's' : ''}</div>
                    </div>
                    <div class="buyer-amount">
                        <div class="buyer-value">${dataManager.formatCurrency(buyer.totalPaid)}</div>
                        <div class="buyer-tickets">${buyer.totalTickets} bilhete${buyer.totalTickets > 1 ? 's' : ''}</div>
                    </div>
                </div>
            `).join('');
        }

        function loadAffiliatesTab(campaign) {
            const container = document.getElementById('affiliatesList');
            
            container.innerHTML = campaign.affiliates.map(affiliate => `
                <div class="affiliate-card">
                    <div class="affiliate-name">${affiliate.name}</div>
                    <div class="affiliate-stats">
                        <div class="affiliate-stat">
                            <strong>${affiliate.sales}</strong><br>
                            <small>Vendas</small>
                        </div>
                        <div class="affiliate-stat">
                            <strong>${dataManager.formatCurrency(affiliate.revenue)}</strong><br>
                            <small>Receita</small>
                        </div>
                        <div class="affiliate-stat">
                            <strong>${dataManager.formatCurrency(affiliate.commission)}</strong><br>
                            <small>Comiss√£o</small>
                        </div>
                        <div class="affiliate-stat">
                            <strong>${affiliate.conversionRate.toFixed(1)}%</strong><br>
                            <small>Convers√£o</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadWinnersTab(campaign) {
            const numbersContainer = document.getElementById('winningNumbers');
            const winnersContainer = document.getElementById('winnersList');

            // N√∫meros ganhadores
            if (campaign.winningNumbers.length > 0) {
                numbersContainer.innerHTML = campaign.winningNumbers.map(number => `
                    <div class="winning-number">${String(number).padStart(3, '0')}</div>
                `).join('');
            } else {
                numbersContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                        üéØ Sorteio ainda n√£o realizado
                    </div>
                `;
            }

            // Lista de ganhadores
            if (campaign.winners.length > 0) {
                winnersContainer.innerHTML = campaign.winners.map(winner => `
                    <div class="buyer-item">
                        <div class="buyer-info">
                            <div class="buyer-name">üèÜ ${winner.name}</div>
                            <div class="buyer-details">${winner.email} ‚Ä¢ Bilhete #${String(winner.ticketNumber).padStart(3, '0')}</div>
                        </div>
                        <div class="buyer-amount">
                            <div class="buyer-value">${winner.prize}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                winnersContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        üèÜ Ganhadores ser√£o definidos ap√≥s o sorteio
                    </div>
                `;
            }
        }

        function closeModal() {
            document.getElementById('campaignModal').style.display = 'none';
        }

        function editCampaign(campaignId) {
            alert(`Editando campanha ${campaignId}`);
        }

        // Fecha modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('campaignModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Inicializa a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            window.campanhasPage = new CampanhasPage();
        });

        // Fun√ß√µes para o suporte
        function openSupportModal() {
            document.getElementById('support-modal').classList.add('active');
        }

        function closeSupportModal() {
            document.getElementById('support-modal').classList.remove('active');
        }

        function openWhatsAppSupport() {
            window.open('https://wa.me/557781484432', '_blank');
            closeSupportModal();
        }

        // Fecha o modal de suporte ao clicar fora dele
        document.addEventListener('click', (e) => {
            if (e.target.id === 'support-modal') {
                closeSupportModal();
            }
        });
    </script>
</body>
</html> 